# Concept: PaperIndex

+ **concept** PaperIndex [Author]
+ **purpose** registry of papers by id (DOI, arXiv, or bioRxiv) with minimal metadata
+ **principle** papers can be added to the index, and paper metadata relevant to
us can be updated
+ **state**
  + a set of Papers with
    + a paperId String
    + an authors Author[]
    + a links String[]
    + a title String?
    + a source "arxiv" | "biorxiv" | "other"
    + a createdAt Date
+ **actions**
  + ensure(paperId: String, title?: String, source?: "arxiv" | "biorxiv" | "other") : (paper: Paper)
    + **requires** nothing
    + **effects** if paper with given paperId is in the set of Papers, returns it.
    Otherwise, creates a new paper with the given paperId, title (if provided),
    source (defaults to "arxiv" if not provided), and links and authors arrays
    set to empty arrays, and returns the new paper
  + updateMeta(paper: Paper, title: String) : ()
    + **requires** the paper is in the set of Papers
    + **effects** sets the title of the paper to the provided title
  + addAuthors(paper: Paper, authors: Author[]) : ()
    + **requires** the paper is in the set of Papers
    + **effects** for each author in the provided authors array, if the author is not
    in the authors array of the paper, adds the author to the authors array of the
    paper
  + removeAuthors(paper: Paper, authors: Author[]) : ()
    + **requires** the paper is in the set of Papers
    + **effects** for each author in the provided authors array, if the author is in
    the authors array of the paper, removes the author from the authors array of the
    paper
  + addLink(paper: Paper, url: String) : ()
    + **requires** the paper is in the set of Papers
    + **effects** if the url is not in the links array of the paper, adds the url to
    the links array of the paper
  + removeLink(paper: Paper, url: String) : ()
    + **requires** the paper is in the set of Papers
    + **effects** if the url is in the links array of the paper, removes the url from
    the links array of the paper. If url is not in the links array of the paper, does
    nothing
+ **queries**
  + _get(paper: Paper) : (paper: PaperDoc)
    + **requires** nothing
    + **effects** returns an array of dictionaries, each containing the paper document
    for the given paper (by internal _id) in the `paper` field. Returns an array with one
    dictionary containing `{ paper: PaperDoc }` if the paper exists, or an empty array if
    the paper does not exist.
  + _getByPaperId(paperId: String) : (paper: PaperDoc)
    + **requires** nothing
    + **effects** returns an array of dictionaries, each containing the paper document
    for the given external paperId in the `paper` field. Returns an array with one dictionary
    containing `{ paper: PaperDoc }` if the paper exists, or an empty array if the paper
    does not exist.
  + _listRecent(limit?: Number, source?: "arxiv" | "biorxiv" | "other") : (paper: PaperDoc)
    + **requires** nothing
    + **effects** returns an array of dictionaries, each containing one paper document
    for the most recently created papers, limited by the provided limit (default 20).
    If source is provided, filters to only papers with that source. Results are ordered
    by createdAt descending. Each paper includes _id, title, source, and createdAt.
    Returns an empty array if no papers exist.
  + _searchArxiv(q: String) : (result: {id: String, title?: String})
    + **requires** nothing
    + **effects** returns an array of dictionaries, each containing one search result
    from the arXiv API matching the query string. Each result includes an id (arXiv identifier)
    and optionally a title. Returns an empty array if no results are found.
  + _searchBiorxiv(q: String) : (result: {id: String, title?: String, doi?: String})
    + **requires** nothing
    + **effects** returns an array of dictionaries, each containing one search result
    from the Europe PMC API matching the query string for bioRxiv preprints. Each result
    includes an id (bioRxiv identifier), optionally a title, and optionally a DOI.
    Returns an empty array if no results are found.
  + _listRecentBiorxiv(limit?: Number) : (result: {id: String, title?: String, doi?: String})
    + **requires** nothing
    + **effects** returns an array of dictionaries, each containing one recent bioRxiv
    preprint from the bioRxiv API. Each result includes an id (DOI), optionally a title.
    Results are ordered by date descending. Limited by the provided limit (default 10).
    Returns an empty array if no results are found.

**Notes:**

+ paperId is not a unique Paper ID generated by mongodb, but rather an external unique
identifier for the paper (DOI, arXiv, or bioRxiv)
