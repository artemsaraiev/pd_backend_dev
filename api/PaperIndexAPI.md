# API Specification: PaperIndex Concept

**Purpose:** registry of papers by id (DOI, arXiv, or bioRxiv) with minimal metadata

**Note:** Endpoints that require authentication will include a `session` parameter in the request body. The session token is obtained via the login endpoint and should be included in all authenticated requests.

---

## API Endpoints

### POST /api/PaperIndex/ensure

**Description:** Ensures a paper exists in the index, creating it if it doesn't exist.

**Requirements:**
- nothing

**Effects:**
- if paper with given paperId is in the set of Papers, returns it. Otherwise, creates a new paper with the given paperId, title (if provided), source (defaults to "arxiv" if not provided), and links and authors arrays set to empty arrays, and returns the new paper

**Request Body:**
```json
{
  "id": "string",
  "title": "string (optional)",
  "source": "arxiv" | "biorxiv" | "other" (optional, defaults to "arxiv")
}
```

**Note:** This endpoint does not require authentication. The `id` parameter is the external unique identifier (DOI, arXiv, bioRxiv, etc.) for the paper. The `source` parameter indicates the origin of the paper.

**Success Response Body (Action):**
```json
{
  "result": "string"
}
```

**Note:** The `result` field contains the internal Paper ID (generated by the backend), not the external `paperId` (DOI, arXiv, etc.) that was provided in the request. The internal ID is used for subsequent operations on the paper.

**Error Response Body:**
```json
{
  "error": "string"
}
```

---

### POST /api/PaperIndex/updateMeta

**Description:** Updates the title metadata of a paper.

**Requirements:**
- the paper is in the set of Papers

**Effects:**
- sets the title of the paper to the provided title

**Request Body:**
```json
{
  "paper": "string",
  "title": "string"
}
```

**Note:** This endpoint does not require authentication. The `paper` parameter is the internal Paper ID (returned by `/api/PaperIndex/ensure`), not the external `paperId` (DOI, arXiv, etc.).

**Success Response Body (Action):**
```json
{
  "ok": true
}
```

**Error Response Body:**
```json
{
  "error": "string"
}
```

---

### POST /api/PaperIndex/addAuthors

**Description:** Adds authors to a paper's author list.

**Requirements:**
- the paper is in the set of Papers

**Effects:**
- for each author in the provided authors array, if the author is not in the authors array of the paper, adds the author to the authors array of the paper

**Request Body:**
```json
{
  "paper": "string",
  "authors": ["string"]
}
```

**Note:** This endpoint does not require authentication. The `paper` parameter is the internal Paper ID (returned by `/api/PaperIndex/ensure`), not the external `paperId` (DOI, arXiv, etc.).

**Success Response Body (Action):**
```json
{
  "ok": true
}
```

**Error Response Body:**
```json
{
  "error": "string"
}
```

---

### POST /api/PaperIndex/removeAuthors

**Description:** Removes authors from a paper's author list.

**Requirements:**
- the paper is in the set of Papers

**Effects:**
- for each author in the provided authors array, if the author is in the authors array of the paper, removes the author from the authors array of the paper

**Request Body:**
```json
{
  "paper": "string",
  "authors": ["string"]
}
```

**Note:** This endpoint does not require authentication. The `paper` parameter is the internal Paper ID (returned by `/api/PaperIndex/ensure`), not the external `paperId` (DOI, arXiv, etc.).

**Success Response Body (Action):**
```json
{
  "ok": true
}
```

**Error Response Body:**
```json
{
  "error": "string"
}
```

---

### POST /api/PaperIndex/addLink

**Description:** Adds a URL link to a paper's links array.

**Requirements:**
- the paper is in the set of Papers

**Effects:**
- if the url is not in the links array of the paper, adds the url to the links array of the paper

**Request Body:**
```json
{
  "paper": "string",
  "url": "string"
}
```

**Note:** This endpoint does not require authentication. The `paper` parameter is the internal Paper ID (returned by `/api/PaperIndex/ensure`), not the external `paperId` (DOI, arXiv, etc.).

**Success Response Body (Action):**
```json
{
  "ok": true
}
```

**Error Response Body:**
```json
{
  "error": "string"
}
```

---

### POST /api/PaperIndex/removeLink

**Description:** Removes a URL link from a paper's links array.

**Requirements:**
- the paper is in the set of Papers

**Effects:**
- if the url is in the links array of the paper, removes the url from the links array of the paper. If url is not in the links array of the paper, does nothing

**Request Body:**
```json
{
  "paper": "string",
  "url": "string"
}
```

**Note:** This endpoint does not require authentication. The `paper` parameter is the internal Paper ID (returned by `/api/PaperIndex/ensure`), not the external `paperId` (DOI, arXiv, etc.).

**Success Response Body (Action):**
```json
{
  "ok": true
}
```

**Error Response Body:**
```json
{
  "error": "string"
}
```

---

### POST /api/PaperIndex/get

**Description:** Retrieves a paper document by its internal ID.

**Requirements:**
- nothing

**Effects:**
- returns the paper document for the given paper (by internal _id) in the `result` field, or null if the paper does not exist.

**Request Body:**
```json
{
  "paper": "string"
}
```

**Note:** The `paper` parameter is the internal Paper ID (returned by `/api/PaperIndex/ensure`), not the external `paperId` (DOI, arXiv, etc.).

**Success Response Body (Query):**
```json
{
  "result": {
    "_id": "string",
    "paperId": "string",
    "title": "string",
    "source": "arxiv" | "biorxiv" | "other",
    "authors": ["string"],
    "links": ["string"],
    "createdAt": "number"
  } | null
}
```

**Note:** The `result` field contains the paper document if it exists, or `null` if the paper does not exist. The `_id` field is MongoDB's internal document identifier (generated by the backend using `freshID()`). The `paperId` field stores the external unique identifier (DOI, arXiv, bioRxiv, etc.) from outside the system. The `source` field indicates the origin of the paper.

**Error Response Body:**
```json
{
  "error": "string"
}
```

---

### POST /api/PaperIndex/getByPaperId

**Description:** Retrieves a paper document by its external paperId (DOI, arXiv, bioRxiv, etc.).

**Requirements:**
- nothing

**Effects:**
- returns the paper document for the given external paperId in the `result` field, or null if the paper does not exist.

**Request Body:**
```json
{
  "paperId": "string"
}
```

**Note:** The `paperId` parameter is the external unique identifier (DOI, arXiv, bioRxiv, etc.), not the internal Paper ID.

**Success Response Body (Query):**
```json
{
  "result": {
    "_id": "string",
    "paperId": "string",
    "title": "string",
    "source": "arxiv" | "biorxiv" | "other",
    "authors": ["string"],
    "links": ["string"],
    "createdAt": "number"
  } | null
}
```

**Note:** The `result` field contains the paper document if it exists, or `null` if the paper does not exist. The `_id` field is MongoDB's internal document identifier (generated by the backend using `freshID()`). The `paperId` field stores the external unique identifier (DOI, arXiv, bioRxiv, etc.) from outside the system. The `source` field indicates the origin of the paper.

**Error Response Body:**
```json
{
  "error": "string"
}
```

---

### POST /api/PaperIndex/listRecent

**Description:** Lists the most recently created papers, optionally filtered by source.

**Requirements:**
- nothing

**Effects:**
- returns an array of dictionaries, each containing one paper document for the most recently created papers, limited by the provided limit (default 20). If source is provided, filters to only papers with that source. Results are ordered by createdAt descending. Each paper includes _id, title, source, and createdAt. Returns an empty array if no papers exist.

**Request Body:**
```json
{
  "limit": "number (optional, default 20)",
  "source": "arxiv" | "biorxiv" | "other" (optional, filters by source)
}
```

**Success Response Body (Query):**
```json
{
  "papers": [
    {
      "paper": {
        "_id": "string",
        "paperId": "string",
        "title": "string",
        "source": "arxiv" | "biorxiv" | "other",
        "authors": ["string"],
        "links": ["string"],
        "createdAt": "number"
      }
    }
  ]
}
```

**Note:** The sync collects all paper frames into a single `papers` array for the response. Each item in the array is wrapped in an object with a key matching the collected variable name (`paper`). The `_id` field is MongoDB's internal document identifier (generated by the backend using `freshID()`). The `paperId` field stores the external unique identifier (DOI, arXiv, bioRxiv, etc.) from outside the system. The `source` field indicates the origin of the paper.

**Error Response Body:**
```json
{
  "error": "string"
}
```

---

### POST /api/PaperIndex/_searchArxiv

**Description:** Searches the arXiv API for papers matching a query string.

**Requirements:**
- nothing

**Effects:**
- returns an array of dictionaries, each containing one search result from the arXiv API matching the query string. Each result includes an id (arXiv identifier) and optionally a title. Returns an empty array if no results are found.

**Request Body:**
```json
{
  "q": "string"
}
```

**Success Response Body (Query):**
```json
{
  "results": [
    {
      "id": "string",
      "title": "string"
    }
  ]
}
```

**Note:** The sync collects all result frames into a single `results` array for the response. This endpoint is public and does not require authentication.

**Error Response Body:**
```json
{
  "error": "string"
}
```

---

### POST /api/PaperIndex/_searchBiorxiv

**Description:** Searches the Europe PMC API for bioRxiv preprints matching a query string.

**Requirements:**
- nothing

**Effects:**
- returns an array of dictionaries, each containing one search result from the Europe PMC API matching the query string for bioRxiv preprints. Each result includes an id (bioRxiv identifier), optionally a title, and optionally a DOI. Returns an empty array if no results are found.

**Request Body:**
```json
{
  "q": "string"
}
```

**Success Response Body (Query):**
```json
[
  {
    "result": {
      "id": "string",
      "title": "string (optional)",
      "doi": "string (optional)"
    }
  }
]
```

**Note:** This endpoint is public and does not require authentication. The `id` field contains the bioRxiv identifier (typically extracted from the DOI).

**Error Response Body:**
```json
{
  "error": "string"
}
```

---

### POST /api/PaperIndex/_listRecentBiorxiv

**Description:** Lists recent bioRxiv preprints from the bioRxiv API.

**Requirements:**
- nothing

**Effects:**
- returns an array of dictionaries, each containing one recent bioRxiv preprint from the bioRxiv API. Each result includes an id (DOI), optionally a title. Results are ordered by date descending. Limited by the provided limit (default 10). Returns an empty array if no results are found.

**Request Body:**
```json
{
  "limit": "number (optional, default 10)"
}
```

**Success Response Body (Query):**
```json
[
  {
    "result": {
      "id": "string",
      "title": "string (optional)",
      "doi": "string (optional)"
    }
  }
]
```

**Note:** This endpoint is public and does not require authentication. The `id` field contains the bioRxiv identifier extracted from the DOI.

**Error Response Body:**
```json
{
  "error": "string"
}
```

---

